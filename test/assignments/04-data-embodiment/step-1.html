<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/Digital-Interfaces/test/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/Digital-Interfaces/test/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } </style> <script src="/Digital-Interfaces/test/assets/js/vendor/lunr.min.js"></script> <script src="/Digital-Interfaces/test/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Setting up MQTT on your ItsyBitsy | Digital Interfaces</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="Setting up MQTT on your ItsyBitsy" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Repository for the BSc course Digital Interfaces" /> <meta property="og:description" content="Repository for the BSc course Digital Interfaces" /> <meta property="og:site_name" content="Digital Interfaces" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Setting up MQTT on your ItsyBitsy" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Repository for the BSc course Digital Interfaces","headline":"Setting up MQTT on your ItsyBitsy","url":"/Digital-Interfaces/test/assignments/04-data-embodiment/step-1.html"}</script> <!-- End Jekyll SEO tag --> <!-- CSS and JS for jekyll-tabs --> <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jekyll-tabs@1.1.0/dist/tabs.css"> --> <!-- <script type="text/javascript" src="/assets/js/tabs.js"></script> --> <script src="/Digital-Interfaces/test/assets/js/tabs.js" type="text/javascript"></script> <link rel="stylesheet" href="/Digital-Interfaces/test/assets/css/tabs.css"> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <header class="side-bar"> <div class="site-header"> <a href="/Digital-Interfaces/test/" class="site-title lh-tight"> Digital Interfaces </a> <button id="menu-button" class="site-button btn-reset" aria-label="Menu" aria-expanded="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Assignments submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/assignments/" class="nav-list-link">Assignments</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/01-reaction-game-hardware%20and%20code/" class="nav-list-link">1: Reaction Game - Hardware and Code</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="3: Game Controller submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/assignments/03-game-controller/" class="nav-list-link">3: Game Controller</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/03-game-controller/coding_instructions.html" class="nav-list-link">Code instructions</a></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/03-game-controller/code_solution.html" class="nav-list-link">Code solution</a></li></ul></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/04-data-embodiment/" class="nav-list-link">4: Data Embodiment</a></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/05-walkie-talkie/" class="nav-list-link">5: Walkie-Talkie</a></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/06-party-lamp/" class="nav-list-link">6: Party Lamp</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="7+8: Animistic Design submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/" class="nav-list-link">7+8: Animistic Design</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/varspeed-library-guide.html" class="nav-list-link">VarSpeed Library Guide</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Fading and blinking a Chainable LED submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/fading-and-blinking-a-chainable-led-index.html" class="nav-list-link">Fading and blinking a Chainable LED</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/fading-and-blinking-a-chainable-led/neopixel.html" class="nav-list-link">Chainable LED ChaiNEO</a></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/fading-and-blinking-a-chainable-led/p9813.html" class="nav-list-link">Chainable LED P9813</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Running two sequences simultaneously submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/running-two-sequences-index.html" class="nav-list-link">Running two sequences simultaneously</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/running-two-sequences/neopixel.html" class="nav-list-link">Chainable LED ChaiNEO</a></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/running-two-sequences/p9813.html" class="nav-list-link">Chainable LED P9813</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Triggering different sequences based on context or interaction submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/trigger-different-sequences-index.html" class="nav-list-link">Triggering different sequences based on context or interaction</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/trigger-different-sequences/neopixel.html" class="nav-list-link">Chainable LED ChaiNEO</a></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/assignments/07+08-animistic-design/trigger-different-sequences/p9813.html" class="nav-list-link">Chainable LED P9813</a></li></ul></li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Tutorials submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/" class="nav-list-link">Tutorials</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/tutorials/01-time/" class="nav-list-link">01 Time in CircuitPython</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="02 Pomodoro submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/" class="nav-list-link">02 Pomodoro</a><ul class="nav-list"><li class="nav-list-item"><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step1.html" class="nav-list-link">Step 1: Preparation</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Step 2: Setting up the states submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step2.html" class="nav-list-link">Step 2: Setting up the states</a><ul class="nav-list"></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Step 3: Adding the LED submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step3.html" class="nav-list-link">Step 3: Adding the LED</a><ul class="nav-list"></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Step 4: Creating a timer submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step4.html" class="nav-list-link">Step 4: Creating a timer</a><ul class="nav-list"></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Step 5: Adding an alarm submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step5.html" class="nav-list-link">Step 5: Adding an alarm</a><ul class="nav-list"></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Step 6: Adding the breaks submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step6.html" class="nav-list-link">Step 6: Adding the breaks</a><ul class="nav-list"></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="Step 7: Additional visualization using the servo submenu" aria-expanded="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step7.html" class="nav-list-link">Step 7: Additional visualization using the servo</a><ul class="nav-list"></ul></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/tutorials/02-pomodoro/step8.html" class="nav-list-link">Step 8 Assembling the embodiment</a></li></ul></li><li class="nav-list-item"><a href="/Digital-Interfaces/test/tutorials/coding-challenge/" class="nav-list-link">Coding Challenge</a></li></ul></li></ul> <ul class="nav-list"><li class="nav-list-item external"> <a href="https://id-studiolab.github.io/Connected-Interaction-Kit" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Connected Interaction Kit <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://brightspace.tudelft.nl/d2l/home/681612" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > DI Brightspace <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://hedy.org/" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > Hedy - Python learning <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://www.w3schools.com/python/" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > W3Schools - Python <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li><li class="nav-list-item external"> <a href="https://docs.circuitpython.org/en/latest/README.html" class="nav-list-link external" target="_blank" rel="noopener noreferrer" > CircuitPython Docs <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a> </li></ul> </nav> <div class="d-md-block d-xs-none"> <div class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </div> </div> </header> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Digital Interfaces" autocomplete="off"> <label for="search-input" class="search-label"> <span class="sr-only">Search Digital Interfaces</span> <svg viewBox="0 0 24 24" class="search-icon" aria-hidden="true"><use xlink:href="#svg-search"></use></svg> </label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><span>Setting up MQTT on your ItsyBitsy</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="setting-up-mqtt-on-your-itsybitsy"> <a href="#setting-up-mqtt-on-your-itsybitsy" class="anchor-heading" aria-labelledby="setting-up-mqtt-on-your-itsybitsy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setting up MQTT on your ItsyBitsy </h1> <p>After successfully completing <a href="https://id-studiolab.github.io/Connected-Interaction-Kit/tutorials/03-connect-to-the-internet/">Tutorial 4</a> and connected your ItsyBitsy to the Internet, follow the steps below to establish a basic MQTT connection with our MQTT server.</p> <ol> <li>Extend your <code class="language-plaintext highlighter-rouge">settings.py</code> file and add the entries for the MQTT broker (the server we connect to), be sure to set your username in the parameter called <strong>mqtt_clientid</strong> (please construct it as <strong>Studio[your studio]_YourName</strong>). Save the file afterwards. <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s">"ssid"</span> <span class="p">:</span> <span class="s">"TUD-facility"</span><span class="p">,</span> <span class="c1"># The wifi we connect to 
</span> <span class="s">"password"</span> <span class="p">:</span> <span class="s">"replace-with-your-iPSK-String"</span><span class="p">,</span> <span class="c1"># Our personal password to connect to Wifi
</span> <span class="s">"mqtt_broker"</span> <span class="p">:</span> <span class="s">"ide-education.cloud.shiftr.io"</span><span class="p">,</span> <span class="c1"># The MQTT server we connect to
</span> <span class="s">"mqtt_user"</span> <span class="p">:</span> <span class="s">"ide-education"</span><span class="p">,</span> <span class="c1"># The username for connecting to the server
</span> <span class="s">"mqtt_password"</span> <span class="p">:</span> <span class="s">"Sy0L85iwSSgc1P7E"</span><span class="p">,</span> <span class="c1"># The password for connecting to the server
</span> <span class="s">"mqtt_clientid"</span><span class="p">:</span> <span class="s">"Studio5_Caspar"</span><span class="p">,</span> <span class="c1"># The device name we present to the server when connecting
</span><span class="p">}</span>
</code></pre></div> </div> </li> <li>Weâ€™ve created a library that helps your microcontroller connect to WiFi, connect to an MQTT broker and takes care of the details of receiving and publishing messages. Download the library using the button below, unzip it, and place the file named <code class="language-plaintext highlighter-rouge">MQTT.py</code> directly in the <code class="language-plaintext highlighter-rouge">lib</code> folder on your microcontroller. Donâ€™t put the entire folder in <code class="language-plaintext highlighter-rouge">lib</code> - just the <code class="language-plaintext highlighter-rouge">MQTT.py</code> file itself.</li> </ol> <p><a href="/Digital-Interfaces/test/assignments/04-data-embodiment/MQTT.zip" class="btn btn-blue">Download MQTT wrapper</a></p> <p>If you followed the tutorial to connect to the wifi replace that code with the one below, otherwise create a new <code class="language-plaintext highlighter-rouge">code.py</code> copy the following code.</p> <blockquote class="note"> <p>TUD-facility can sometimes be unreliable, you can choose to use your phone hotspot instead. To do so change <code class="language-plaintext highlighter-rouge">settings.py</code> and set the <strong>ssid</strong> to the name of your hotspot and the <strong>password</strong> to your password.</p> <p>If youâ€™re using an iPhone it is necessary that you turn on the <strong>Maximize-Compatibility</strong> option in your hotspot settings.</p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##--- Library Imports
</span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">digitalio</span>
<span class="kn">import</span> <span class="nn">board</span>

<span class="kn">from</span> <span class="nn">MQTT</span> <span class="kn">import</span> <span class="n">Create_MQTT</span>
<span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="c1">##--- Defining states
</span><span class="n">state_idle</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">state_received_value</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">current_state</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Define variable to save data received from the MQTT broker
</span><span class="n">last_received_value</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">device_has_received_new_value</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1">##--- MQTT Setup
</span>
<span class="c1"># Method used when the board receives 
# a message from the MQTT server.
</span><span class="k">def</span> <span class="nf">handle_message</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">last_received_value</span>
    <span class="k">global</span> <span class="n">device_has_received_new_value</span>

    <span class="c1"># Assign message received to last_received variable
</span>    <span class="n">last_received_value</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="n">device_has_received_new_value</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># You can find the client Id in the settings.py this is used to identify the board
</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s">"mqtt_clientid"</span><span class="p">]</span>


<span class="c1"># &lt;--------------------------------------------&gt;
# --     CHOOSE YOUR LISTEN TOPIC HERE        --
# VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV
</span>
<span class="c1"># Here you can choose what topic you want to subscribe to. The default is Perlin Noise.
# Make sure there is only one topic active at any given time (and otherwise add a # before the one you do not want to use anymore)
</span>
<span class="n">MQTT_topic</span> <span class="o">=</span> <span class="s">"perlin"</span>
<span class="c1">#MQTT_topic = "iss/distance"
#MQTT_topic = "iss/location"
#MQTT_topic = "coffee-waiting-line"
#MQTT_topic = "windspeed"
#MQTT_topic = "temperature"
</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
# &lt;--------------------------------------------&gt;
</span>
<span class="c1"># Create a mqtt connection based on the settings file.
</span><span class="n">mqtt_client</span> <span class="o">=</span> <span class="n">Create_MQTT</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">handle_message</span><span class="p">)</span>

<span class="c1"># Listen for messages on the topic specified above
</span><span class="n">mqtt_client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">MQTT_topic</span><span class="p">)</span>


<span class="c1"># --- Main loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># This try / except loop is used to continuously get new data from MQTT, and reset if anything goes wrong
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">mqtt_client</span><span class="p">.</span><span class="n">loop</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="nb">ValueError</span><span class="p">,</span> <span class="nb">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Failed to get data, retrying</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">mqtt_client</span><span class="p">.</span><span class="n">reconnect</span><span class="p">()</span>
        <span class="k">continue</span>
    <span class="c1"># ---------------------------------------------
</span>    <span class="c1"># ^ DO NOT CHANGE ANYTHING ABOVE THIS POINT ^ |
</span>    <span class="c1"># ---------------------------------------------
</span>
    <span class="c1"># ----------------------------------------------------------------| 
</span>    <span class="c1">#                                                                 | 
</span>    <span class="c1"># Use the Acting Machine Diagram to program your solution here    | 
</span>    <span class="c1">#                                                                 | 
</span>    <span class="c1"># ----------------------------------------------------------------|
</span>
    <span class="c1"># Example to print the received data - you may want to use this for your code solution
</span>    <span class="k">if</span> <span class="n">device_has_received_new_value</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">last_received_value</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------
</span>    <span class="c1"># v DO NOT CHANGE ANYTHING BELOW THIS POINT v  |
</span>    <span class="c1"># ----------------------------------------------
</span>    <span class="n">device_has_received_new_value</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

</code></pre></div></div> <blockquote class="attention"> <p>If youâ€™re trying to use the value received from MQTT for calculations, you might encounter the following errors.</p> <ul> <li>TypeError: unsupported operand type(s) for +: â€˜intâ€™ and â€˜strâ€™</li> <li>TypeError: cannot concatenate â€˜strâ€™ and â€˜intâ€™ objects</li> </ul> <p>Thatâ€™s because the received value is in the form of text (string in python), so we need to convert it before we use it.</p> <ul> <li>You can convert it to a whole number using: <code class="language-plaintext highlighter-rouge">last_received_value = int(last_received_value)</code></li> <li>Or to a decimal number using: <code class="language-plaintext highlighter-rouge">last_received_value = float(last_received_value)</code></li> </ul> </blockquote> <h3 id="acting-machine-diagram"> <a href="#acting-machine-diagram" class="anchor-heading" aria-labelledby="acting-machine-diagram"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Acting Machine Diagram </h3> <div style="text-align: center;"> <img src="data_embodiment_state_diagram.png" alt="Data Embodiment Acting Machine Diagram" style="width:70%;" /> </div> <ol> <li>With the code above we connect to an MQTT client, specify the <strong>topic</strong> and listen to the data being sent to it. If you want to process the data received you can use the <code class="language-plaintext highlighter-rouge">last_received_value</code> variable in the <code class="language-plaintext highlighter-rouge">while True</code> loop.</li> </ol> <p>In the next page we show some useful functions on how to process the data received.</p> <p><a href="index" class="btn btn-gray">Previous Step</a> <a href="step-2" class="btn btn-blue">Next Step</a></p><hr /> <h2 id="extra-challenge-use-advanced-components"> <a href="#extra-challenge-use-advanced-components" class="anchor-heading" aria-labelledby="extra-challenge-use-advanced-components"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Extra Challenge: Use Advanced Components </h2> <p>Now that you have successfully managed messages from MQTT, you can push your project further by incorporating additional components beyond the standard Connected Interaction Kit. This challenge encourages you to explore and integrate elements that can enhance the interactivity and visual appeal of your design.</p> <p>Below are some components you can experiment with:</p> <ul> <li>LED Strip (WS2812 / Neopixel)</li> <li>LED Ring</li> <li>LED Segment Bar</li> <li>LCD Screen</li> <li>Speaker / MP3 Player</li> <li>Fans</li> </ul> <p class="note">A basic introduction on how to use these components can be found here below:</p> <p><a href="https://ide-studiolab.notion.site/Complete-Prototyping-Component-List-5882007ea7e94a7db77ad8bd3892cd24" class="btn btn-blue">Complete Prototyping Components List</a></p> <p>Be creative and experiment! This challenge is about exploring new possibilities and applying what youâ€™ve learned to enhance your project. ðŸš€</p> </main> <hr> <footer> <div class="d-xs-block d-md-none"> <div class="mt-4 fs-2"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </div> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
